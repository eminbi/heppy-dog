import cv2
import numpy as np
import json

def preprocess_frame(frame):
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    blur = cv2.GaussianBlur(gray, (5, 5), 0)
    return blur

def extract_features(frame):
    mean = np.mean(frame)
    std = np.std(frame)
    return mean, std

def save_features_to_json(features, json_filename='features.json'):
    with open(json_filename, mode='a') as file:
        json.dump(features, file)
        file.write('\n')  # 줄바꿈을 추가하여 각 기록을 구분

def process_video_stream(video_path):
    cap = cv2.VideoCapture(video_path)
    
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break

        processed_frame = preprocess_frame(frame)
        mean, std = extract_features(processed_frame)

        # 특징을 딕셔너리로 만들어 저장
        features = {
            "mean": mean,
            "std": std
        }
        
        save_features_to_json(features)

        cv2.imshow('Processed Frame', processed_frame)

        if cv2.waitKey(1) & 0xFF == ord('q'):
            break
    
    cap.release()
    cv2.destroyAllWindows()

# 비디오 파일 경로
video_path = 'your_video.mp4'
process_video_stream(video_path)
